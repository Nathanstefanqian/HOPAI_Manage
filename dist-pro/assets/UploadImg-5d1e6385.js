import{d as F,p as l,c9 as J,r as _,ca as P,c7 as G,c8 as H,o as i,c as o,i as c,w as L,a as r,V as N,g as n,aJ as I,q as Q,a3 as d,b3 as R,F as X,t as g,be as Y,l as Z,_ as ee,__tla as ae}from"./index-9a3dc6a8.js";import{E as te,__tla as se}from"./el-image-viewer-9fcd8ab9.js";import{g as z,O as le,__tla as ie}from"./index-669fa91c.js";import{u as oe,__tla as re}from"./useMessage-78b6afd0.js";import{_ as ce}from"./_plugin-vue_export-helper-1b428a4d.js";let B,ne=Promise.all([(()=>{try{return ae}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return re}catch{}})()]).then(async()=>{let b,k,w,v,T,x,S;b={class:"upload-box"},k=["src"],w={key:0},v={key:0},T={key:0},x={key:1,class:"upload-empty"},S={class:"el-upload__tip"},B=ce(F({name:"UploadImg",__name:"UploadImg",props:{modelValue:l.string.def(""),drag:l.bool.def(!0),disabled:l.bool.def(!1),fileSize:l.number.def(5),fileType:l.array.def(["image/jpeg","image/png","image/gif"]),height:l.string.def("150px"),width:l.string.def("150px"),borderradius:l.string.def("8px"),showDelete:l.bool.def(!0),showBtnText:l.bool.def(!0)},emits:["update:modelValue"],setup(t,{emit:C}){J(e=>({"5134fbb4":t.width,"88c8fe0e":t.height,dfd34be0:t.borderradius}));const p=t,{t:y}=Z(),u=oe(),V=_("id-"+P()),m=_(!1),K=C,$=()=>{K("update:modelValue","")},q=_({Authorization:"Bearer "+G(),"tenant-id":H()}),E=()=>{const e=document.querySelector(`#${V.value} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},U=async e=>{var a=e.file.name;let s=await j(a,e.file);s=await D(a);let h=s.indexOf("?");s=s.substring(0,h),K("update:modelValue",s),u.success("\u4E0A\u4F20\u6210\u529F")};let f;(async()=>{let e=await z();f=new le({region:"oss-cn-shanghai",accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken,bucket:"hopai-user-portrait",refreshSTSToken:async()=>(e=await z(),{accessKeyId:e.credentials.accessKeyId,accessKeySecret:e.credentials.accessKeySecret,stsToken:e.credentials.securityToken})})})();const j=async(e,a)=>{try{return await f.put(e,a)}catch{}},D=async e=>{try{return await f.signatureUrl(`${e}`)}catch{}},M=e=>{const a=e.size/1024/1024<p.fileSize,s=p.fileType;return s.includes(e.type)||u.notifyWarning("\u4E0A\u4F20\u56FE\u7247\u4E0D\u7B26\u5408\u6240\u9700\u7684\u683C\u5F0F\uFF01"),a||u.notifyWarning(`\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 ${p.fileSize}M\uFF01`),s.includes(e.type)&&a},O=()=>{u.notifyError("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01")};return(e,a)=>{const s=ee,h=R,W=te;return i(),o("div",b,[c(h,{id:r(V),"http-request":U,class:N(["upload",t.drag?"no-border":""]),multiple:!1,"show-file-list":!1,headers:r(q),"before-upload":M,"on-error":O,drag:t.drag,accept:t.fileType.join(",")},{default:L(()=>[t.modelValue?(i(),o(X,{key:0},[n("img",{src:t.modelValue,class:"upload-image"},null,8,k),n("div",{class:"upload-handle",onClick:a[1]||(a[1]=Y(()=>{},["stop"]))},[n("div",{class:"handle-icon",onClick:E},[c(s,{icon:"ep:edit"}),t.showBtnText?(i(),o("span",w,g(r(y)("action.edit")),1)):d("",!0)]),n("div",{class:"handle-icon",onClick:a[0]||(a[0]=A=>m.value=!0)},[c(s,{icon:"ep:zoom-in"}),t.showBtnText?(i(),o("span",v,g(r(y)("action.detail")),1)):d("",!0)]),t.showDelete?(i(),o("div",{key:0,class:"handle-icon",onClick:$},[c(s,{icon:"ep:delete"}),t.showBtnText?(i(),o("span",T,g(r(y)("action.del")),1)):d("",!0)])):d("",!0)])],64)):(i(),o("div",x,[I(e.$slots,"empty",{},()=>[c(s,{icon:"ep:plus"})],!0)]))]),_:3},8,["id","class","headers","drag","accept"]),n("div",S,[I(e.$slots,"tip",{},void 0,!0)]),r(m)?(i(),Q(W,{key:0,onClose:a[2]||(a[2]=A=>m.value=!1),"url-list":[t.modelValue]},null,8,["url-list"])):d("",!0)])}}}),[["__scopeId","data-v-e25668d0"]])});export{B as _,ne as __tla};
