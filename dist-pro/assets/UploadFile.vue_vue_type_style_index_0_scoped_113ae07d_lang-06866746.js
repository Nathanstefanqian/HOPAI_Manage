import{d as H,p as o,r,co as L,cp as Q,aQ as P,o as C,c as D,i as _,ct as G,w as V,a as h,x as U,aT as w,bm as J,g as p,j as m,t as S,av as K,_ as N,H as W,__tla as X}from"./index-ad2885e5.js";import{u as Y,__tla as Z}from"./useMessage-db992d55.js";let j,ee=Promise.all([(()=>{try{return X}catch{}})(),(()=>{try{return Z}catch{}})()]).then(async()=>{let x,g,b,z,O;x={class:"upload-file"},g={style:{"font-size":"8px"}},b={style:{color:"#f56c6c"}},z={style:{"font-size":"8px"}},O={style:{color:"#f56c6c"}},j=H({name:"UploadFile",__name:"UploadFile",props:{modelValue:o.oneOfType([String,Array]).isRequired,title:o.string.def("\u6587\u4EF6\u4E0A\u4F20"),updateUrl:o.string.def("http://47.103.169.246:48080/admin-api/infra/file/upload"),fileType:o.array.def(["doc","xls","ppt","txt","pdf"]),fileSize:o.number.def(5),limit:o.number.def(5),autoUpload:o.bool.def(!0),drag:o.bool.def(!1),isShowTip:o.bool.def(!0)},emits:["update:modelValue"],setup(i,{emit:$}){const s=Y(),B=$,a=i,f=r(a.modelValue),I=r(),d=r([]),t=r([]),c=r(0),k=r({Authorization:"Bearer "+L(),"tenant-id":Q()}),A=e=>{if(t.value.length>=a.limit)return s.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${a.limit}\u4E2A!`),!1;let l="";e.name.lastIndexOf(".")>-1&&(l=e.name.slice(e.name.lastIndexOf(".")+1));const u=a.fileType.some(n=>e.type.indexOf(n)>-1||!!(l&&l.indexOf(n)>-1)),v=e.size<1024*a.fileSize*1024;return u?v?(s.success("\u6B63\u5728\u4E0A\u4F20\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."),void c.value++):(s.error(`\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7${a.fileSize}MB!`),!1):(s.error(`\u6587\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E, \u8BF7\u4E0A\u4F20${a.fileType.join("/")}\u683C\u5F0F!`),!1)},F=e=>{s.success("\u4E0A\u4F20\u6210\u529F");const l=t.value;l.pop(),t.value=l,d.value.push({name:e.data,url:e.data}),d.value.length==c.value&&(t.value=t.value.concat(d.value),d.value=[],c.value=0,T())},M=()=>{s.error(`\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7${a.limit}\u4E2A!`)},R=()=>{s.error("\u5BFC\u5165\u6570\u636E\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01")},q=e=>{const l=t.value.map(u=>u.name).indexOf(e.name);l>-1&&(t.value.splice(l,1),T())},E=e=>{};P(()=>a.modelValue,()=>{const e=[];if(w(a.modelValue))a.modelValue.includes(",")?e.concat(a.modelValue.split(",")):a.modelValue.length>0&&e.push(a.modelValue);else{if(!K(a.modelValue))throw new Error("\u4E0D\u652F\u6301\u7684 modelValue \u7C7B\u578B");e.concat(a.modelValue)}t.value=e.map(l=>({url:l,name:l.substring(l.lastIndexOf("/")+1)}))},{immediate:!0});const T=()=>{let e=t.value.map(l=>l.url);w(a.modelValue)&&(e=e.join(",")),B("update:modelValue",e)};return(e,l)=>{const u=N,v=W,n=J;return C(),D("div",x,[_(n,{ref_key:"uploadRef",ref:I,multiple:a.limit>1,name:"file",modelValue:h(f),"onUpdate:modelValue":l[0]||(l[0]=y=>U(f)?f.value=y:null),"file-list":h(t),"onUpdate:fileList":l[1]||(l[1]=y=>U(t)?t.value=y:null),"show-file-list":!0,"auto-upload":i.autoUpload,action:i.updateUrl,headers:h(k),limit:a.limit,drag:i.drag,"before-upload":A,"on-exceed":M,"on-success":F,"on-error":R,"on-remove":q,"on-preview":E,class:"upload-file-uploader"},G({default:V(()=>[_(v,{type:"primary"},{default:V(()=>[_(u,{icon:"ep:upload-filled"}),m("\u9009\u53D6\u6587\u4EF6")]),_:1})]),_:2},[i.isShowTip?{name:"tip",fn:V(()=>[p("div",g,[m(" \u5927\u5C0F\u4E0D\u8D85\u8FC7 "),p("b",b,S(i.fileSize)+"MB",1)]),p("div",z,[m(" \u683C\u5F0F\u4E3A "),p("b",O,S(i.fileType.join("/")),1),m(" \u7684\u6587\u4EF6 ")])]),key:"0"}:void 0]),1032,["multiple","modelValue","file-list","auto-upload","action","headers","limit","drag"])])}}})});export{j as _,ee as __tla};
